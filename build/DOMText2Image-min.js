"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var DOMText2Image=function(){function t(){_classCallCheck(this,t),this.element=document.createElement("div"),this.cnv=document.createElement("canvas"),this.ctx=this.cnv.getContext("2d"),this.scale=window.devicePixelRatio}return _createClass(t,[{key:"convertText",value:function(t){var e=window.getComputedStyle(t);return document.body.appendChild(this.element),this.element.innerHTML=t.innerHTML,this.element.style.position="fixed",this.element.style.left="0px",this.element.style.top="0px",this.element.style.width=e.width,this.element.style.fontFamily=e.fontFamily,this.element.style.fontSize=e.fontSize,this.element.style.textAlign=e.textAlign,this.element.style.visibility="hidden",this.element.setAttribute("DomText2ImageDiv","true"),this.extractedProperties=[],this.extractNodeProperties(this.element,this.extractedProperties),this.modifyExtractedProperties(),this.prepareCanvas()}},{key:"extractNodeProperties",value:function(t,e){for(var n,i=t.childNodes,o=0;o<i.length;o++){i[o].nodeType===Node.TEXT_NODE?(n=window.getComputedStyle(t),e.push({nodeName:"true"===t.getAttribute("DomText2ImageDiv")?"SPAN":t.nodeName,fontFamily:n.getPropertyValue("font-family"),fontSize:n.getPropertyValue("font-size"),fontWeight:n.getPropertyValue("font-weight"),fontStyle:n.getPropertyValue("font-style"),color:n.getPropertyValue("color"),text:i[o].textContent})):"BR"===i[o].nodeName?e.push({nodeName:i[o].nodeName,text:"<br/>"}):this.extractNodeProperties(i[o],e)}}},{key:"modifyExtractedProperties",value:function(){var a="";this.extractedProperties.forEach(function(t,e){var n,i,o;"BR"!==t.nodeName&&(n="<".concat(t.nodeName,' style="font-family:').concat(t.fontFamily,"; font-size:").concat(t.fontSize,"; font-weight:").concat(t.fontWeight,"; font-style:").concat(t.fontStyle,"; color:").concat(t.color,';">'),i="</".concat(t.nodeName,">"),o=t.text.split(" ").join("".concat(i," ").concat(n)),t.text="".concat(n).concat(o).concat(i)),a="".concat(a).concat(t.text)}),this.element.innerHTML=a}},{key:"prepareCanvas",value:function(){var t=this.element.offsetWidth,e=this.element.offsetHeight;this.cnv.width=t*this.scale,this.cnv.height=e*this.scale,this.ctx.clearRect(0,0,this.cnv.width,this.cnv.height),this.ctx.save(),this.ctx.scale(this.scale,this.scale);for(var n,i=this.element.children,o=0;o<i.length;o++){"BR"!==i[o].nodeName&&(n=window.getComputedStyle(i[o]),parseFloat(n.fontSize),this.ctx.fillStyle=n.color,this.ctx.font="".concat(n.fontStyle," ").concat(n.fontWeight," ").concat(n.fontSize," ").concat(n.fontFamily),this.ctx.textBaseline="bottom",this.ctx.fillText(i[o].textContent,i[o].offsetLeft,i[o].offsetTop+i[o].offsetHeight))}return this.ctx.restore(),{img:this.cnv.toDataURL(),width:t,height:e}}}]),t}();